<!DOCTYPE html>
<html>
  <head>
    <title>Viewport size</title>
    <style>
      body {
        --ruler-num-c: #888;
        --ruler-num-fz: 10px;
        --ruler-num-pi: 0.75ch;
        --ruler-unit: 1px;
        --ruler-x: 1;
        --ruler-y: 1;

        --ruler1-bdw: 1px;
        --ruler1-c:  #BBB;
        --ruler1-h: 8px;
        --ruler1-space: 5;

        --ruler2-bdw: 1px;
        --ruler2-c:  #BBB;
        --ruler2-h: 20px;
        --ruler2-space: 50;

        background-attachment: fixed;
        background-image:
          linear-gradient(90deg, var(--ruler1-c) 0 var(--ruler1-bdw), transparent 0),
          linear-gradient(90deg, var(--ruler2-c) 0 var(--ruler2-bdw), transparent 0),
          linear-gradient(0deg, var(--ruler1-c) 0 var(--ruler1-bdw), transparent 0),
          linear-gradient(0deg, var(--ruler2-c) 0 var(--ruler2-bdw), transparent 0);
        background-position: 0 0;
        background-repeat: repeat-x, repeat-x, repeat-y, repeat-y;
        background-size:
          calc(var(--ruler-unit) * var(--ruler1-space) * var(--ruler-x)) var(--ruler1-h),
          calc(var(--ruler-unit) * var(--ruler2-space) * var(--ruler-x)) var(--ruler2-h),
          var(--ruler1-h) calc(var(--ruler-unit) * var(--ruler1-space) * var(--ruler-y)),
          var(--ruler2-h) calc(var(--ruler-unit) * var(--ruler2-space) * var(--ruler-y));
      }

      /* Ruler Numbers */
      .ruler-x,
      .ruler-y {
        color: var(--ruler-num-c);
        counter-reset: d 0;
        display: flex;
        font-size: var(--ruler-num-fz);
        line-height: 1;
        list-style: none;
        margin: 0;
        overflow: hidden;
        padding: 0;
        position: fixed;
      }
      .ruler-x {
        height: var(--ruler2-h);
        inset-block-start: 0;
        inset-inline-start: calc(var(--ruler-unit) * var(--ruler2-space));
        inset-inline-start: 0;
        opacity: var(--ruler-x);
        width: 100%;
      }
      .ruler-y {
        flex-direction: column;
        height: 100%;
        inset-block-start: 0;
        inset-inline-start: 0;
        opacity: var(--ruler-y);
        width: var(--ruler2-h);
      }
      .ruler-x li {
        align-self: flex-end;
      }
      .ruler-x li,
      .ruler-y li {
        counter-increment: d var(--ruler2-space);
        flex: 0 0 calc(var(--ruler-unit) * var(--ruler2-space));
      }
      .ruler-x li::after {
        content: counter(d)"\00a0";
        display: block;
        line-height: 1;
        text-align: end;
      }
      .ruler-y li::after {
        content: "\00a0"counter(d);
        display: block;
        transform: rotate(-90deg) translateX(-100%) translateY(10px);
        transform-origin: 0% 0%;
        text-align: start;
        width: calc(var(--ruler-unit) * var(--ruler2-space));
      }

      /* Additional css for test page */
      body {
        height: 100vh;
        margin: 0;
        font-family: monospace;
        font-size 16px;
        padding-top: 50px;
        box-sizing: border-box;
      }
      section {
        box-sizing: border-box;
        margin: 8px 8px 0px 50px;
        max-width: 305px;
      }
      .pageid, .no-page-id {
        margin-top: 0px;
      }
      .note {
        margin-top: 16px;
        font-size: 10px;
        opacity: 0.38;
      }
      .hide {
        display: none;
      }
    </style>
  </head>
  <body>
    <ul class="ruler-x">
      <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
    </ul>
    <ul class="ruler-y">
      <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
    </ul>
    <section class="withid pageid hide">Page id: <span id="pageid"></span></section>
    <section class="woid no-pageid hide">No page id, size won't be stored</section>
    <section class="dimensions">
      <div class="current">Current: <span id="width"></span> x <span id="height"></span></div>
      <div class="withid previous hide">&nbsp;&nbsp;Prev.: <span id="prev-width">???</span> x <span id="prev-height">???</span></div>
    </section>
    <section class="withid note hide">Previous size is stored in a cookie.</section>
    <section class="note"><div>Rulers based on</div><div><a href="https://dev.to/madsstoumann/build-a-css-ruler-2opn">https://dev.to/madsstoumann/build-a-css-ruler-2opn</a></div></section>
    <script type="module">
      const hash = window.location.hash;
      const spanWidth = document.querySelector('#width');
      const spanHeight = document.querySelector('#height');
      function readId () {
        const hash = window.location.hash;
        if (hash) {
          try {
            return decodeURIComponent(hash.replace('#', '')).trim();
          } catch (e) {
            return null;
          }
        }
        return null;
      }
      let id =readId();
      function getAllDimensionData() {
        try {
          const json = document.cookie
            .split("; ")
            .find((row) => row.startsWith("prevSessionDimensions="))
            ?.split("=")[1];
          const jsonValue = JSON.parse(json);
          if (typeof jsonValue == 'object' && !!jsonValue) {
            return jsonValue;
          }
          return {};
        } catch (e) {
          return {};
        }
      }
      function updateDimensions() {
        const w = window.innerWidth;
        const h = window.innerHeight;
        spanWidth.textContent = `${w}px`;
        spanHeight.textContent = `${h}px`;
        if (!id) return;
        const allData = getAllDimensionData();
        allData[id] = {"width": w, "height": h};
        document.cookie=`prevSessionDimensions=${JSON.stringify(allData)}; Max-Age=3600;`;
      }
      function readPrevDimension() {
        if (!id) {
          return [null, null];
        }
        try {
          const allData = getAllDimensionData();
          const data = allData[id];
          if (!data) {
            throw 'no data';
          }

          if (typeof data == 'object' && !!data && typeof data['width'] == 'number' && typeof data['height'] == 'number') {
            return [data['width'], data['height']];
          }
          throw 'invalid data';
        } catch (e) {
          return [null, null];
        }
      }
      function initView() {
        if (!!id) {
          Array.from(document.querySelectorAll('.withid')).forEach((e) => {
            e.classList.remove('hide');
            e.classList.add('show')
          });
          Array.from(document.querySelectorAll('.woid')).forEach((e) => {
            e.classList.remove('show');
            e.classList.add('hide')
          });
          document.querySelector('#pageid').textContent = id;
          document.title = `Viewport size of ${id}`;
        } else {
          Array.from(document.querySelectorAll('.woid')).forEach((e) => {
            e.classList.remove('hide');
            e.classList.add('show')
          });
          Array.from(document.querySelectorAll('.withid')).forEach((e) => {
            e.classList.remove('show');
            e.classList.add('hide')
          });
          document.title = `Viewport size`;
        }
        const [prevWidht, prevHeight] = readPrevDimension();
        if (typeof prevWidht == 'number' && typeof prevHeight == 'number') {
          document.querySelector('#prev-width').textContent = `${prevWidht}px`;
          document.querySelector('#prev-height').textContent = `${prevHeight}px`;
        } else {
          document.querySelector('#prev-width').textContent = `???`;
          document.querySelector('#prev-height').textContent = `???`;
        }
        updateDimensions();
      }
      initView();
      addEventListener('resize', (event) => updateDimensions());
      window.addEventListener('hashchange', function () {
        id = readId();
        initView();
      });
    </script>
  </body>
</html>
